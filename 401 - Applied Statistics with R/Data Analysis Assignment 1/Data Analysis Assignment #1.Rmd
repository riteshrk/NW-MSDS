---
title: 'Data Analysis Assignment #1 (50 points total)'
author: "Kumar Ritesh"
output:
  html_document: default
---

```{r setup, include = FALSE}
# DO NOT ADD OR REVISE CODE HERE
knitr::opts_chunk$set(echo = FALSE, eval = TRUE)

```


Submit both the .Rmd and .html files for grading. You may remove the instructions and example problem above, but do not remove the YAML metadata block or the first, "setup" code chunk.  Address the steps that appear below and answer all the questions. Be sure to address each question with code and comments as needed.  You may use either base R functions or ggplot2 for the visualizations.

-----

The following code chunk will:

(a) load the "ggplot2", "gridExtra" and "knitr" packages, assuming each has been installed on your machine,
(b) read-in the abalones dataset, defining a new data frame, "mydata,"
(c) return the structure of that data frame, and
(d) calculate new variables, VOLUME and RATIO.

Do not include package installation code in this document. Packages should be installed via the Console or 'Packages' tab. You will also need to download the abalones.csv from the course site to a known location on your machine. Unless a *file.path()* is specified, R will look to directory where this .Rmd is stored when knitting.

```{r analysis_setup1, message = FALSE, warning = FALSE}

# a) Load the ggplot2 and gridExtra packages.

library(ggplot2)
library(gridExtra)
library(moments)
library(knitr)
library(RColorBrewer)

# b) Use read.csv() to read the abalones.csv into R, assigning the data frame to "mydata."

mydata <- read.csv("abalones.csv", sep = ",", stringsAsFactors = TRUE)
mydata$CLASS <- factor(mydata$CLASS)
mydata$SEX <- factor(mydata$SEX)

# c) Use the str() function to verify the structure of "mydata." You should have 1036 observations
# of eight variables.

str(mydata)

# d) Define two new variables, VOLUME and RATIO. Use the following statements to define VOLUME and
# RATIO as variables appended to the data frame "mydata."

mydata$VOLUME <- mydata$LENGTH * mydata$DIAM * mydata$HEIGHT
mydata$RATIO <- mydata$SHUCK / mydata$VOLUME

```

-----

### Test Items starts from here - There are 6 sections - Total 50 points

***##### Section 1: (6 points) Summarizing the data.***

(1)(a) (1 point) Use *summary()* to obtain and present descriptive statistics from mydata.  Use *table()* to present a frequency table using CLASS and RINGS. There should be 115 cells in the table you present.  

```{r Part_1a}
summary(mydata)
numeric_columns = sapply(mydata, is.numeric)
skewness_values = sapply(mydata[, numeric_columns], skewness, na.rm=TRUE)
skewness_values
table(mydata$CLASS, mydata$RINGS)
```

**Question (1 point):  Briefly discuss the variable types and distributional implications such as potential skewness and outliers.**

***Answer: The categorical variables in the dataset include SEX and CLASS, while the remaining variables are numeric Among these numeric variables, HEIGHT most closely approximates a symmetrical normal distribution, exhibiting a skewness of -0.225262 and a mean and median that are nearly identical. Conversely, LENGTH and DIAM display negative skewness values of -0.67 and -0.62, respectively, indicating the existence of outliers (data points with much lower values) that result in a lower mean compared to the median. In contrast, WHOLE, SHUCK, RINGS, VOLUME, and RATIO exhibit positive skewness values of 0.47, 0.64, 1.24, 0.44, and 0.72, respectively, which suggests the presence of outliers (data points with much higher values) that cause the mean to exceed the median. ***

(1)(b) (1 point) Generate a table of counts using SEX and CLASS. Add margins to this table (Hint: There should be 15 cells in this table plus the marginal totals. Apply *table()* first, then pass the table object to *addmargins()* (Kabacoff Section 7.2 pages 144-147)).  Lastly, present a barplot of these data; ignoring the marginal totals.  

```{r Part_1b}
tab1 = table(mydata$SEX, mydata$CLASS)
addmargins(tab1)
summ1 = data.frame(tab1)
colnames(summ1) = c('Sex','Class','Frequency')
ggplot(summ1, aes(x=Class, y=Frequency, fill=Sex, group=Sex)) + geom_bar(stat='identity', position=position_dodge()) + ggtitle('Abalone by Class and Sex')+ theme(plot.title = element_text(hjust = 0.5)) + scale_fill_manual(values=c('maroon','darkblue','darkgreen'))

```

**Essay Question (2 points):  Discuss the sex distribution of abalones.  What stands out about the distribution of abalones by CLASS?**

***Answer: It is intriguing to observe a substantially higher number of infants in both A1 and A2. This may suggest that the classification of these abalones as male or female was challenging. Moreover, the higher number of infants in A2 compared to A1 implies that relying on ring counting as an age determination method may be inaccurate or difficult. The varying frequency of each sex across classes is also noteworthy. Could there be an unidentified third factor contributing to the significant presence of males in category A3, which then drops considerably by A5? One might anticipate a gradual increase in male/female numbers over time as more infants mature and are accurately sexed. This raises the question if there is another classification issue distorting the data.***

(1)(c) (1 point) Select a simple random sample of 200 observations from "mydata" and identify this sample as "work." Use *set.seed(123)* prior to drawing this sample. Do not change the number 123. Note that *sample()* "takes a sample of the specified size from the elements of x." We cannot sample directly from "mydata." Instead, we need to sample from the integers, 1 to 1036, representing the rows of "mydata." Then, select those rows from the data frame (Kabacoff Section 4.10.5 page 87). 

Using "work", construct a scatterplot matrix of variables 2-6 with *plot(work[, 2:6])* (these are the continuous variables excluding VOLUME and RATIO). The sample "work" will not be used in the remainder of the assignment. 

```{r Part_1c}
set.seed(123)
random_integers = sort(sample(1:1036, 200, replace=FALSE))
work = mydata[random_integers,]
plot(work[, 2:6], cex=.2, lwd=.2)
```

-----

***##### Section 2: (5 points) Summarizing the data using graphics.***

(2)(a) (1 point) Use "mydata" to plot WHOLE versus VOLUME. Color code data points by CLASS.

```{r Part_2a}
ggplot(data=mydata, aes(x=VOLUME, y=WHOLE)) + geom_point(aes(color=CLASS),size = 1) + ggtitle('Whole vs Volume') + theme(plot.title = element_text(hjust = 0.5)) + scale_color_brewer(palette="GnBu") + ylab('Whole') + xlab('Volume')

```


(2)(b) (2 points) Use "mydata" to plot SHUCK versus WHOLE with WHOLE on the horizontal axis. Color code data points by CLASS. As an aid to interpretation, determine the maximum value of the ratio of SHUCK to WHOLE.  Add to the chart a straight line with zero intercept using this maximum value as the slope of the line. If you are using the 'base R' *plot()* function, you may use *abline()* to add this line to the plot. Use *help(abline)* in R to determine the coding for the slope and intercept arguments in the functions. If you are using ggplot2 for visualizations, *geom_abline()* should be used.

```{r Part_2b}
ggplot(data=mydata, aes(x=WHOLE, y=SHUCK)) + geom_point(aes(color=CLASS), size=1) + scale_color_brewer(palette="GnBu") + ggtitle('Shuck vs Whole') +theme(plot.title = element_text(hjust = 0.5)) + geom_abline(intercept=0, slope=max(mydata$SHUCK/mydata$WHOLE), linewidth=.25, linetype=2) + ylab("Shuck") + xlab('Whole') 

cor_whole_vol = cor(mydata$WHOLE, mydata$VOLUME, use = "pairwise.complete.obs", method = "pearson")
cor_whole_vol
cor_whole_shuck = cor(mydata$WHOLE, mydata$SHUCK, use = "pairwise.complete.obs", method = "pearson")
cor_whole_shuck

```

**Essay Question (2 points):  How does the variability in this plot differ from the plot in (a)?  Compare the two displays.  Keep in mind that SHUCK is a part of WHOLE.  Consider the location of the different age classes.**

***Answer: The first plot exhibits greater variability compared to the second plot, implying a stronger correlation(0.9734) between the weights of the shucked and whole abalones than the correlation(0.9677) between the volume and weight of the abalones. Moreover, the first plot displays consistency in variability across all classes. However, the second plot reveals a peculiar pattern of "banding" by class, indicating that the older the abalone, the more variable the data appears to be, ultimately resulting in a lower shuck-to-weight ratio. This trend suggests that as abalones mature, the weight of their shells may be increasing at a faster rate than the weight of their meat (the portion that is "shucked").***

-----

***### Section 3: (8 points) Getting insights about the data using graphs.***

(3)(a) (2 points) Use "mydata" to create a multi-figured plot with histograms, boxplots and Q-Q plots of RATIO differentiated by sex. This can be done using *par(mfrow = c(3,3))* and base R or *grid.arrange()* and ggplot2. The first row would show the histograms, the second row the boxplots and the third row the Q-Q plots. Be sure these displays are legible.  

```{r Part_3a}
a = ggplot(mydata, aes(RATIO, fill=SEX)) + facet_grid(. ~ SEX, space="free") + geom_histogram(color="black", size=.2, bins=30) + scale_fill_brewer(palette="Dark2") + ggtitle("Histograms of Ratio") + theme(legend.position="none", axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5))

b = ggplot(mydata, aes(y=RATIO, fill=SEX)) + facet_grid(cols = vars(SEX)) + geom_boxplot(color="black", size=.2, outlier.size=2, outlier.shape=1) + scale_fill_brewer(palette="Dark2") + ggtitle("Box-Plots of Ratio") + theme(legend.position="none", axis.title=element_blank(), plot.title = element_text(hjust = 0.5))

c = ggplot(mydata, aes(sample=RATIO, color=SEX)) + facet_grid(cols = vars(SEX)) + geom_qq(cex=2, shape=1) + scale_fill_brewer(palette="Dark2") + ggtitle("QQ Plots of Ratio") + geom_qq_line(color="black", cex=.5) + theme(legend.position="none", plot.title = element_text(hjust = 0.5)) 

grid.arrange(a, b, c, nrow=3)

```

**Essay Question (2 points): Compare the displays.  How do the distributions compare to normality? Take into account the criteria discussed in the sync sessions to evaluate non-normality.**

***Answer: The distributions in all three graphs appear to be skewed to the right and do not appear to follow a normal distribution at first glance. The presence of mild and extreme outliers in all three graphs, particularly in the female and infant distributions, is likely the reason for this. Positive skewness is evident in all three plots for each graph, as indicated by the long right tails in the histograms, the IQRs on the lower end with outliers on the upper end in the boxplots, and the QQ plot values trending above the QQ line, especially for the most positive values. Although the female distribution seems to have the most extreme outliers, the infant distribution has the highest number of outliers.***

(3)(b) (2 points) The boxplots in (3)(a) indicate that there are outlying RATIOs for each sex. *boxplot.stats()* can be used to identify outlying values of a vector. Present the abalones with these outlying RATIO values along with their associated variables in "mydata". Display the observations by passing a data frame to the kable() function. Basically, we want to output those rows of "mydata" with an outlying RATIO, but we want to determine outliers looking separately at infants, females and males.

```{r Part_3b}
infant = mydata[mydata$SEX == "I" & mydata$RATIO %in% boxplot.stats(x = mydata$RATIO[mydata$SEX == "I"])$out, ]
feamle = mydata[mydata$SEX == "F" & mydata$RATIO %in% boxplot.stats(x = mydata$RATIO[mydata$SEX == "F"])$out, ]
male =  mydata[mydata$SEX == "M" & mydata$RATIO %in% boxplot.stats(x = mydata$RATIO[mydata$SEX == "M"])$out, ]
kable(rbind(infant, feamle, male))

```

**Essay Question (2 points):  What are your observations regarding the results in (3)(b)?**

***Answer: The majority of outliers for ratio are observed in the infant category. The vast majority of outliers belong to the younger A1-A3 classifications, with only a single outlier belonging to A5. Furthermore, extreme outliers are only observed in the female and infant categories, with none detected in the male category. The high number of outliers in the younger age categories may be distorting the data and making it challenging to establish a correlation between physical measurements and age.***

-----

***### Section 4: (8 points) Getting insights about possible predictors.***

(4)(a) (3 points) With "mydata," display side-by-side boxplots for VOLUME and WHOLE, each differentiated by CLASS There should be five boxes for VOLUME and five for WHOLE. Also, display side-by-side scatterplots:  VOLUME and WHOLE versus RINGS. Present these four figures in one graphic:  the boxplots in one row and the scatterplots in a second row. Base R or ggplot2 may be used.


```{r Part_4a}
b_v_c = ggplot(mydata, aes(x=CLASS, y=VOLUME, fill=CLASS)) + geom_boxplot(color="black", size=.1, outlier.shape=1) + scale_fill_brewer(palette="Dark2") + ggtitle("Volume vs Class") + theme(legend.position="none", plot.title = element_text(hjust = 0.5)) + xlab('Class') + ylab('Volume')

b_w_c = ggplot(mydata, aes(x=CLASS, y=WHOLE, fill=CLASS)) + geom_boxplot(color="black", size=.1, outlier.shape=1) + scale_fill_brewer(palette="Dark2") + ggtitle("Whole vs Class") + theme(legend.position="none", plot.title = element_text(hjust = 0.5)) + xlab('Class') + ylab('Whole')

s_r_v = ggplot(data = mydata, aes(x = RINGS, y = VOLUME)) + geom_point(size = .5,) + scale_fill_brewer(palette="Dark2") + ggtitle("Volume vs Rings") + theme(legend.position="none", plot.title = element_text(hjust = 0.5)) + xlab('Rings') + ylab('Volume')

s_r_w = ggplot(data = mydata, aes(x = RINGS, y = WHOLE)) + geom_point(size = .5,) + scale_fill_brewer(palette="Dark2") + ggtitle("Whole vs Rings") + theme(legend.position="none", plot.title = element_text(hjust = 0.5)) + xlab('Rings') + ylab('Whole')

grid.arrange(b_v_c, b_w_c, s_r_v, s_r_w, nrow=2)

```

**Essay Question (5 points) How well do you think these variables would perform as predictors of age?  Explain.**

***Answer: Both volume and whole weight are weak predictors of an abalone's age. While they do show a positive correlation with the number of rings, the correlation is not very strong. For instance, an abalone with with volume 500 (or weight of 150) could have anywhere from 8 to 23 rings. The relationship between volume/weight and the abalone's classification as younger or older is also weak, particularly for classes A3, A4, and A5, which have similar IQRs for both volume and weight. An abalone with a volume of 250 or weight of 125 could be classified as belonging to any of these classes. This suggests that volume and weight are not very accurate predictors of an abalone's exact age, but may provide a rough estimate. Alternatively, it could indicate that the age classification system itself is flawed, given that counting the rings is a challenging and labor-intensive task.***

-----

***### Section 5: (12 points) Getting insights regarding different groups in the data.***

(5)(a) (2 points) Use *aggregate()* with "mydata" to compute the mean values of VOLUME, SHUCK and RATIO for each combination of SEX and CLASS. Then, using *matrix()*, create matrices of the mean values. Using the "dimnames" argument within *matrix()* or the *rownames()* and *colnames()* functions on the matrices, label the rows by SEX and columns by CLASS. Present the three matrices (Kabacoff Section 5.6.2, p. 110-111). The *kable()* function is useful for this purpose.  You do not need to be concerned with the number of digits presented.

```{r Part_5a}
agg = aggregate(mydata[c('VOLUME', 'SHUCK', 'RATIO')], FUN=mean, by=list(mydata$SEX, mydata$CLASS))
mat_vol = matrix(agg$VOLUME, nrow=3, dimnames = list(list('F', 'I', 'M'), list('A1', 'A2', 'A3', 'A4', 'A5')))
mat_shu = matrix(agg$SHUCK, nrow=3, dimnames = list(list('F', 'I', 'M'), list('A1', 'A2', 'A3', 'A4', 'A5')))
mat_rat = matrix(agg$RATIO, nrow=3, dimnames = list(list('F', 'I', 'M'), list('A1', 'A2', 'A3', 'A4', 'A5')))
kable(mat_vol, caption="Volume")
kable(mat_shu, caption="Shuck")
kable(mat_rat, caption="Ratio")

```

(5)(b) (3 points) Present three graphs. Each graph should include three lines, one for each sex. The first should show mean RATIO versus CLASS; the second, mean VOLUME versus CLASS; the third, mean SHUCK versus CLASS. This may be done with the 'base R' *interaction.plot()* function or with ggplot2 using *grid.arrange()*.

```{r Part_5b, fig.width = 9}
colnames(agg) = c('Sex', 'Class', 'Volume', 'Shuck', 'Ratio')

c_r = ggplot(data = agg, aes(x = Class, y = Ratio, group=Sex, color=Sex)) + geom_line(size=1) + ggtitle("Mean Ratio vs Class") + scale_color_brewer(palette = "Dark2") + theme(plot.title = element_text(hjust = 0.5))

v_r = ggplot(data = agg, aes(x = Class, y = Volume, group=Sex, color=Sex)) + geom_line(size=1) + ggtitle("Mean Volume vs Class") + scale_color_brewer(palette = "Dark2") + theme(plot.title = element_text(hjust = 0.5))

s_r = ggplot(data = agg, aes(x = Class, y = Shuck, group=Sex, color=Sex)) + geom_line(size=1) + ggtitle("Mean Shuck vs Class") + scale_color_brewer(palette = "Dark2") + theme(plot.title = element_text(hjust = 0.5))

grid.arrange(c_r, v_r, s_r, nrow=3)

```

**Essay Question (2 points):  What questions do these plots raise?  Consider aging and sex differences.**

***Answer: In general, the mean shuck/volume ratio decreases with age (class) for all sexes, while both volume and shuck increase with age. However, examining the plots raises several questions about the differences in shuck and volume between genders. For instance, why are females larger and heavier than males and infants? Additionally, although females are heavier and larger, why do they exhibit slower growth over time compared to males and infants? The small difference between female A1 and A2 (in terms of volume and shuck) may indicate that females develop more slowly, but further investigation is needed. It is also unclear why infants consistently weigh less and are smaller than adults, yet have a lower shuck/volume ratio. Is this due to infants genuinely having a lower shuck/volume ratio, or is it harder to determine the sex of an abalone with a lower ratio? Finally, it is unclear why both adults and infants tend to shrink (i.e., get lighter/smaller) between A4 and A5.***

5(c) (3 points) Present four boxplots using *par(mfrow = c(2, 2)* or *grid.arrange()*. The first line should show VOLUME by RINGS for the infants and, separately, for the adult; factor levels "M" and "F," combined. The second line should show WHOLE by RINGS for the infants and, separately, for the adults. Since the data are sparse beyond 15 rings, limit the displays to less than 16 rings. One way to accomplish this is to generate a new data set using subset() to select RINGS < 16.  Use ylim = c(0, 1100) for VOLUME and ylim = c(0, 400) for WHOLE.  If you wish to reorder the displays for presentation purposes or use ggplot2 go ahead.

```{r Part_5c}
iv = ggplot(subset(mydata, mydata$RINGS < 16 & mydata$SEX == "I"), aes(x=RINGS, y=VOLUME, fill=RINGS, group=RINGS)) + geom_boxplot(color="black", size=.1, outlier.shape=1, fill="steelblue1") + ggtitle("Infant Volume vs Rings") + theme(legend.position="none", plot.title = element_text(hjust = 0.5)) + coord_cartesian(ylim = c(0, 1100)) + ylab("Volume") + xlab("Rings")

av = ggplot(subset(mydata, mydata$RINGS < 16 & (mydata$SEX == "M" | mydata$SEX == "F")), aes(x=RINGS, y=VOLUME, fill=RINGS, group=RINGS)) + geom_boxplot(color="black", size=.1, outlier.shape=1, fill="royalblue2") + ggtitle("Adult Volume vs Rings") + theme(legend.position="none", plot.title = element_text(hjust = 0.5)) + coord_cartesian(ylim = c(0, 1100)) + ylab("Volume") + xlab("Rings")

iw = ggplot(subset(mydata, mydata$RINGS < 16 & mydata$SEX == "I"), aes(x=RINGS, y=WHOLE, fill=RINGS, group=RINGS)) + geom_boxplot(color="black", size=.1, outlier.shape=1, fill="lightseagreen") + ggtitle("Infant Whole vs Rings") + theme(legend.position="none", plot.title = element_text(hjust = 0.5)) + coord_cartesian(ylim = c(0, 400)) + ylab("Whole") + xlab("Rings")

aw = ggplot(subset(mydata, mydata$RINGS < 16 & (mydata$SEX == "M" | mydata$SEX == "F")), aes(x=RINGS, y=WHOLE, fill=RINGS, group=RINGS)) + geom_boxplot(color="black", size=.1, outlier.shape=1, fill="darkseagreen") + ggtitle("Adult Whole vs Rings") + theme(legend.position="none", plot.title = element_text(hjust = 0.5)) + coord_cartesian(ylim = c(0, 400)) + ylab("Whole") + xlab("Rings")

grid.arrange(iv, av, iw, aw, nrow=2)

```

**Essay Question (2 points):  What do these displays suggest about abalone growth?  Also, compare the infant and adult displays.  What differences stand out?**

***Answer: Based on these displays, it appears that the majority of abalone growth occurs in the first half of their lifespan, from 1 ring up to 10-11 rings, during which time both volume and weight increase at a rapid rate. However, growth appears to level off, and even decrease, after reaching 10-11 rings. Despite the expectation that infants would have lower volumes and weights than adults, there is a surprising amount of overlap between the two displays. For instance, an abalone with a volume of 500 or weight of 150 is highly likely to be an adult based on volume/weight alone. However, any volume or weight below this threshold could easily be an infant or an adult. Interestingly, many abalone classified as "infants" have similar sizes and weights as some of the smaller/lighter adults. Furthermore, the infants tend to have more similar volumes/weights to each other, with smaller IQRs and standard deviations, except for a group of highly variable 12-ring infants. In comparison, the adults exhibit greater variability in volume and weight within each ring grouping overall.***

-----

***### Section 6: (11 points) Conclusions from the Exploratory Data Analysis (EDA).***


**Conclusions**


**Essay Question 1) (5 points)	Based solely on these data, what are plausible statistical reasons that explain the failure of the original study? Consider to what extent physical measurements may be used for age prediction.**

***Answer: The original study may have failed to accurately predict abalone age due to the inaccurate classification of immature abalone. Since it can be challenging to correctly determine the sex of immature abalone, distinguishing between immature and small adult abalone can be difficult, and this sex information is crucial for accurate age prediction based on physical measurements. Furthermore, the growth of abalone by size and weight appears to slow down considerably after the abalone reach 10-11 rings, as weight and volume do not increase proportionally with an increase in rings. For young abalone, where lower weight/volume correlates with fewer rings, the sex of the abalone can significantly impact their size/weight (as observed in the 5b displays, where females tend to be bigger/heavier than males and infants). However, in later years (as seen in the 5c displays), abalone size/weight does not increase proportionally with the number of rings. Given that there is not a strong correlation between volume-rings and weight-rings to begin with (as shown in the 4b displays), it is almost impossible to accurately determine the age of A3-A5 abalone based solely on physical measurements. Therefore, inaccurate sex classification and a slow-down in weight/volume growth in A3-A5 make age prediction using physical measurements difficult.***

**Essay Question 2) (3 points) Do not refer to the abalone data or study.  If you were presented with an overall histogram and summary statistics from a sample of some population or phenomenon and no other information, what questions might you ask before accepting them as representative of the sampled population or phenomenon?**

***Answer: To determine whether the sample used in the study is representative of the population, it would be important to consider various factors. Firstly, information on the sampling methods used would be essential. For instance, was a simple random sample employed, or was a non-random sampling technique utilized? How was the sampling frame constructed, and when was the sample taken? It would also be crucial to determine the sample size and how it compares to the population size. Additionally, understanding the known population parameters or estimating them would be valuable. Moreover, identifying any known biases or other influential factors that might affect the sample's representativeness would be necessary. Overall, several factors could impact whether the sample used in the study is truly representative of the population.***

**Essay Question 3)  (3 points)	Do not refer to the abalone data or study.  What do you see as difficulties analyzing data derived from observational studies? Can causality be determined?  What might be learned from such studies?**

***Answer: Analyzing observational data can be challenging due to the numerous factors involved. Human error and bias at various stages of the study, including its design, data collection, and analysis, can have a significant impact on the results. Observational studies may also miss or overlook critical explanatory variables that could influence the response variable. Without a control group, observational studies can only establish correlations, and causality cannot be determined. However, they can identify variables of interest that could be studied further to determine causality. In summary, observational studies are limited by their inability to establish causality, but they remain valuable for identifying potential relationships and variables of interest for future studies.***
